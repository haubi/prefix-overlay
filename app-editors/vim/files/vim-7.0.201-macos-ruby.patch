--- vim7/src/if_ruby.c
+++ vim7/src/if_ruby.c
@@ -54,7 +54,7 @@
 #undef _
 
 /* T_DATA defined both by Ruby and Mac header files, hack around it... */
-#ifdef FEAT_GUI_MAC
+#if defined(MACOS_X_UNIX) /* || defined(FEAT_GUI_MAC) */
 # define __OPENTRANSPORT__
 # define __OPENTRANSPORTPROTOCOL__
 # define __OPENTRANSPORTPROVIDERS__
