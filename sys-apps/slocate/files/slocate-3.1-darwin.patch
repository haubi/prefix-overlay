--- src/conf.c
+++ src/conf.c
@@ -26,6 +26,15 @@
 #include "utils.h"
 #include "cmds.h"
 
+#ifndef HAVE_STRNDUP
+char* strndup(const char* ptr, size_t n)
+{
+	char* result = (char*) malloc(n);
+	strncpy(result, ptr, n-1);
+	result[n] = 0;
+	return result;
+}
+#endif
 
 char * get_next_char(char ch, char *ptr)
 {
--- src/utils.c
+++ src/utils.c
@@ -139,6 +139,7 @@
 	    ret = 1;		
 
 EXIT:
+#ifndef FNM_CASEFOLD
 	if (nocase_str)
 	    free(nocase_str);
 	nocase_str = NULL;
@@ -147,7 +148,8 @@
 	    free(nocase_path);
 	
 	nocase_path = NULL;
-	
+#endif
+
 	return ret;
 }
 
