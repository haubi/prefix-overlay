* to get environ, one needs to call _NSGetEnviron() on Darwin.

--- dbus/dbus-sysdeps.c
+++ dbus/dbus-sysdeps.c
@@ -47,6 +47,11 @@
 #include <errno.h>
 #endif
 
+/* For OSX's _NSGetEnviron() */
+#ifdef __APPLE_CC__
+#include <crt_externs.h>
+#endif
+
 _DBUS_DEFINE_GLOBAL_LOCK (win_fds);
 _DBUS_DEFINE_GLOBAL_LOCK (sid_atom_cache);
 _DBUS_DEFINE_GLOBAL_LOCK (system_users);
@@ -191,7 +196,11 @@
   if (clearenv () != 0)
      rc = FALSE;
 #else
+#ifdef __APPLE_CC__
+  char **environ = *_NSGetEnviron();
+#else
   extern char **environ;
+#endif
 
   if (environ != NULL)
     environ[0] = NULL;
