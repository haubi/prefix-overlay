#!/bin/bash

catpkg=$1
mkdir -p $catpkg
cd $catpkg

wget http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/$catpkg/ChangeLog
wget http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/$catpkg/metadata.xml
ebuild=$(grep "+" ChangeLog | head -n 1 | sed -e "s:.*+::" -e "s/://")
P=${ebuild/.ebuild}
PN=${P%-*}

wget http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/$catpkg/$ebuild
mkdir files
wget -P files http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/$catpkg/files/digest-${P}

for i in $(grep FILESDIR $ebuild | sed -e "s:.*/::" -e "s:\${P}:$P:" -e "s:\${PN}:$PN:"); do
	wget -P files http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/$catpkg/files/$i
done
eapify $ebuild
ecleankw $ebuild
ekeyword ~x86-macos $ebuild
