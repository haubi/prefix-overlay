--- m4/libtool.m4
+++ m4/libtool.m4
@@ -2261,7 +2261,7 @@
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext_cmds='`test .$module = .yes && echo .bundle || echo .dylib`'
 m4_if([$1], [],[
   sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/local/lib"])
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
--- configure
+++ configure
@@ -10547,7 +10547,7 @@
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext_cmds='`test .$module = .yes && echo .bundle || echo .dylib`'
 
   sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/local/lib"
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
@@ -14365,7 +14365,7 @@
   soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
-  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+  shrext_cmds='`test .$module = .yes && echo .bundle || echo .dylib`'
 
   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
   ;;
--- lib/new_filter.cpp
+++ lib/new_filter.cpp
@@ -458,11 +458,23 @@
       module->file.assign(option_file.str(), slash + 1 - option_file.str());
       //module->file += "lib";
       module->file += filter_name;
-      module->file += "-filter.so";
+      module->file += "-filter."
+#ifdef __APPLE_CC__
+		  "bundle"
+#else
+		  "so"
+#endif
+		  ;
     } else {
       if (module->file[0] != '/')
         module->file.insert(0, option_file.str(), slash + 1 - option_file.str());
-      module->file += ".so";
+      module->file += "."
+#ifdef __APPLE_CC__
+		  "bundle"
+#else
+		  "so"
+#endif
+		  ;
     }
 
     return module.release();
