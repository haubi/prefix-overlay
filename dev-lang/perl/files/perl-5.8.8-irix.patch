--- Configure,orig	Wed Aug 20 21:37:48 2008
+++ Configure	Wed Aug 20 21:39:49 2008
@@ -17710,7 +17710,14 @@
 ACAT(Cir,cus)
 EOCP
 $cppstdin $cppflags $cppminus <cpp_stuff.c >cpp_stuff.out 2>&1
-if $contains 'Circus' cpp_stuff.out >/dev/null 2>&1; then
+# MIPSPro compiler/preprocessor behaves differently if invoked on
+# stdin vs file.  Here we test for stdin, but lateron we use files.
+# So force it to work the way we know it does:
+if [ x"${OPSYS}" = x"IRIX" ]; then
+	echo "Hacking MIPSPro on file vs. stdin..." >&4
+	echo "We know we can catify or stringify, separately or together!"
+	cpp_stuff=42
+elif $contains 'Circus' cpp_stuff.out >/dev/null 2>&1; then
 	echo "Oh!  Smells like ANSI's been here." >&4
 	echo "We can catify or stringify, separately or together!"
 	cpp_stuff=42
--- pp_sys.c,orig	Wed Aug 20 21:40:10 2008
+++ pp_sys.c	Wed Aug 20 21:43:13 2008
@@ -4516,12 +4516,15 @@
 	when = (Time_t)SvIVx(POPs);
 #endif
 
-    if (PL_op->op_type == OP_LOCALTIME)
+    if (PL_op->op_type == OP_LOCALTIME) {
 #ifdef LOCALTIME_EDGECASE_BROKEN
 	tmbuf = S_my_localtime(aTHX_ &when);
 #else
+	/* Explicitly invoke tzset() as localtime_r may not. */
+	tzset();
 	tmbuf = localtime(&when);
 #endif
+    }
     else
 	tmbuf = gmtime(&when);
 
