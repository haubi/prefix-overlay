--- eselect-xvmc-0.2.eselect.orig	2009-02-28 21:24:30 +0100
+++ eselect-xvmc-0.2.eselect	2009-02-28 21:33:31 +0100
@@ -7,15 +7,24 @@
 SVN_DATE='$Date: 2008/10/29 14:37:29 $'
 VERSION=$(svn_date_to_version "${SVN_DATE}" )
 
+LIBDIR=/usr/lib
+XVMCCONFIG=/etc/X11/XvMCConfig
+
+get_libname() {
+	[[ $(uname) == "Darwin" ]] \
+		&& echo ${1:+.}${1}.dylib \
+		|| echo .so${1:+.}${1}
+}
+
 XVMCLIBS=(
-"libXvMCNVIDIA_dynamic.so.1"
-"libXvMC.so.1"
-"libviaXvMC.so.1"
-"libchromeXvMC.so.1"
-"libviaXvMCPro.so.1"
-"libchromeXvMCPro.so.1"
-"libI810XvMC.so.1"
-"libAMDXvBA.so.1" )
+"libXvMCNVIDIA_dynamic$(get_libname 1)"
+"libXvMC$(get_libname 1)"
+"libviaXvMC$(get_libname 1)"
+"libchromeXvMC$(get_libname 1)"
+"libviaXvMCPro$(get_libname 1)"
+"libchromeXvMCPro$(get_libname 1)"
+"libI810XvMC$(get_libname 1)"
+"libAMDXvBA$(get_libname 1)" )
 XVMCPRETTY=(
 "nvidia"
 "xorg-x11"
@@ -29,7 +38,7 @@
 get_implementation_indices() {
 	local ret n
 	for (( n = 0; n < ${#XVMCLIBS[@]}; ++n )); do
-		[[ -e "${ROOT}/usr/lib/${XVMCLIBS[n]}" ]] && ret+=($n)
+		[[ -e "${ROOT}${LIBDIR}/${XVMCLIBS[n]}" ]] && ret+=($n)
 	done
 
 	echo ${ret[@]}
@@ -37,8 +46,8 @@
 
 get_current_implementation_index() {
 	local n
-	if [[ -f "${ROOT}/etc/X11/XvMCConfig" ]]; then
-		local current=$(< "${ROOT}/etc/X11/XvMCConfig")
+	if [[ -f "${ROOT}${XVMCCONFIG}" ]]; then
+		local current=$(< "${ROOT}${XVMCCONFIG}")
 		for (( n = 0; n < ${#XVMCLIBS[@]}; ++n )); do
 			if [[ "${XVMCLIBS[n]}" = "${current}" ]]; then
 				echo "${n}"
@@ -52,11 +61,11 @@
 
 set_new_implementation() {
 	echo -n "Switching to ${XVMCPRETTY[$1]} XvMC implementation..."
-	touch "${ROOT}/etc/X11/XvMCConfig" 2&>1 > /dev/null
+	touch "${ROOT}${XVMCCONFIG}" 2&>1 > /dev/null
 	if [[ $? -eq 0 ]]; then
-		echo "${XVMCLIBS[$1]}" > "${ROOT}/etc/X11/XvMCConfig"
-		chmod 644 "${ROOT}/etc/X11/XvMCConfig"
-		chown 0:0 "${ROOT}/etc/X11/XvMCConfig"
+		echo "${XVMCLIBS[$1]}" > "${ROOT}${XVMCCONFIG}"
+		chmod 644 "${ROOT}${XVMCCONFIG}"
+		chown 0:0 "${ROOT}${XVMCCONFIG}"
 		echo " done"
 	else
 		echo " failed!"
