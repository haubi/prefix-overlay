--- vi.eselect-1.1.5
+++ vi.eselect-1.1.5
@@ -11,12 +11,12 @@
 find_targets() {
 	local f
 	for f in \
-			${ROOT}/usr/bin/vim \
-			${ROOT}/usr/bin/nvi \
-			${ROOT}/usr/bin/elvis \
-			${ROOT}/usr/bin/vile \
-			${ROOT}/usr/bin/gvim \
-			${ROOT}/usr/bin/xvile \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/vim \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/nvi \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/elvis \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/vile \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/gvim \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/xvile \
 		; do
 		if [[ -f ${f} ]] ; then
 			echo $(basename ${f} )
@@ -26,8 +26,8 @@
 
 # try to remove the vi, ex, view and man vi symlinks
 remove_symlinks() {
-	rm -f "${ROOT}"/usr/bin/{vi,ex,view} &>/dev/null && \
-	rm -f "${ROOT}"/usr/share/man/man1/{vi,ex,view}.1{,.gz,.bz2} &>/dev/null
+	rm -f "${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/{vi,ex,view} &>/dev/null && \
+	rm -f "${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/share/man/man1/{vi,ex,view}.1{,.gz,.bz2} &>/dev/null
 }
 
 # set a man page symlink
@@ -35,7 +35,7 @@
 	local target="${1}" link_name="${2}" x extension
 
 	for x in ".1" ".1.bz2" ".1.gz" ; do
-		if [[ -e /usr/share/man/man1/${target}${x} ]] ; then
+		if [[ -e "@GENTOO_PORTAGE_EPREFIX@"/usr/share/man/man1/${target}${x} ]] ; then
 			extension="${x}"
 			break
 		fi
@@ -47,7 +47,7 @@
 	fi
 
 	ln -s "${target}${extension}" \
-		"${ROOT}/usr/share/man/man1/${link_name}${extension}"
+		"${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/share/man/man1/${link_name}${extension}"
 }
 
 # set the vi, ex, view, and man vi symlinks
@@ -57,7 +57,7 @@
 		targets=( $(find_targets ) )
 		target=${targets[$(( ${target} - 1 ))]}
 	fi
-	if [[ -f "${ROOT}/usr/bin/${target}" ]] ; then
+	if [[ -f "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/${target}" ]] ; then
 		remove_symlinks
 
 		# it's okay if these fail
@@ -66,12 +66,12 @@
 		set_man_symlink "${target}" "view"
 
 		# it's not okay if these fail
-		ln -s "${ROOT}/usr/bin/${target}" "${ROOT}/usr/bin/vi" || \
-			die "Couldn't set ${target} /usr/bin/vi symlink"
-		ln -s "${ROOT}/usr/bin/${target}" "${ROOT}/usr/bin/ex" || \
-			die "Couldn't set ${target} /usr/bin/ex symlink"
-		ln -s "${ROOT}/usr/bin/${target}" "${ROOT}/usr/bin/view" || \
-			die "Couldn't set ${target} /usr/bin/view symlink"
+		ln -s "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/${target}" "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" || \
+			die "Couldn't set ${target} @GENTOO_PORTAGE_EPREFIX@/usr/bin/vi symlink"
+		ln -s "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/${target}" "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/ex" || \
+			die "Couldn't set ${target} @GENTOO_PORTAGE_EPREFIX@/usr/bin/ex symlink"
+		ln -s "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/${target}" "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/view" || \
+			die "Couldn't set ${target} @GENTOO_PORTAGE_EPREFIX@/usr/bin/view symlink"
 	else
 		die -q  "Target \"${1}\" doesn't appear to be valid!"
 	fi
@@ -85,9 +85,9 @@
 	[[ -z "${@}" ]] || die -q "Too many parameters"
 
 	write_list_start "Current vi implementation:"
-	if [[ -L "${ROOT}/usr/bin/vi" ]] ; then
-		write_kv_list_entry "$(basename $(canonicalise ${ROOT}/usr/bin/vi ) )" ""
-	elif [[ -e "${ROOT}/usr/bin/vi" ]] ; then
+	if [[ -L "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
+		write_kv_list_entry "$(basename $(canonicalise ${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi ) )" ""
+	elif [[ -e "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		write_kv_list_entry "(not a symlink)" ""
 	else
 		write_kv_list_entry "(unset)" ""
@@ -107,7 +107,7 @@
 	targets=( $(find_targets ) )
 	if [[ -n ${targets[@]} ]] ; then
 		for (( i = 0 ; i < ${#targets[@]} ; i = i + 1 )) ; do
-			[[ ${targets[${i}]} == $(basename $(canonicalise ${ROOT}/usr/bin/vi ) ) ]] && \
+			[[ ${targets[${i}]} == $(basename $(canonicalise ${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi ) ) ]] && \
 				targets[${i}]="${targets[${i}]} $(highlight '*' )"
 		done
 		write_list_start "Available vi implementations:"
@@ -138,15 +138,15 @@
 	elif [[ -n "${2}" ]] ; then
 		die -q "Too many parameters"
 
-	elif [[ -L "${ROOT}/usr/bin/vi" ]] ; then
+	elif [[ -L "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		if ! remove_symlinks ; then
 			die -q "Can't remove existing provider"
 		elif ! set_symlinks "${1}" ; then
 			die -q "Can't set new provider"
 		fi
 
-	elif [[ -e "${ROOT}/usr/bin/vi" ]] ; then
-		die -q "Sorry, ${ROOT}/usr/bin/vi confuses me"
+	elif [[ -e "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
+		die -q "Sorry, ${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi confuses me"
 
 	else
 		set_symlinks "${1}" || die -q "Can't set a new provider"
@@ -167,11 +167,11 @@
 	[[ -z "${1}" ]] || ( [[ -z "${2}" ]] && [[ "${1}" == "--if-unset" ]] ) || \
 		die -q "Usage error"
 
-	if [[ -L "${ROOT}/usr/bin/vi" ]] ; then
+	if [[ -L "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		[[ ${1} == "--if-unset" ]] && return
 		remove_symlinks || die -q "Can't remove existing link"
 	fi
-	if [[ -e "${ROOT}/usr/bin/vi" ]] ; then
+	if [[ -e "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		die -q "Can't set a new provider"
 	elif ! [[ -z $(find_targets ) ]] ; then
 		set_symlinks 1 || die -q "Can't set a new provider"
