--- vi.eselect-1.1.6.orig	2008-10-07 19:47:50.552989229 +0200
+++ vi.eselect-1.1.6	2008-10-07 19:54:10.656427250 +0200
@@ -11,13 +11,13 @@
 find_targets() {
 	local f
 	for f in \
-			"${ROOT}"/usr/bin/vim \
-			"${ROOT}"/usr/bin/nvi \
-			"${ROOT}"/usr/bin/elvis \
-			"${ROOT}"/usr/bin/vile \
-			"${ROOT}"/usr/bin/gvim \
-			"${ROOT}"/usr/bin/xvile \
-			"${ROOT}"/bin/busybox \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/vim \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/nvi \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/elvis \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/vile \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/gvim \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/xvile \
+			"${ROOT}@GENTOO_PORTAGE_EPREFIX@"/bin/busybox \
 		; do
 		if [[ -f "${f}" ]] ; then
 			echo $(basename "${f}" )
@@ -27,8 +27,8 @@
 
 # try to remove the vi, ex, view and man vi symlinks
 remove_symlinks() {
-	rm -f "${ROOT}"/usr/bin/{vi,ex,view} &>/dev/null && \
-	rm -f "${ROOT}"/usr/share/man/man1/{vi,ex,view}.1{,.gz,.bz2,.lzma} &>/dev/null
+	rm -f "${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/bin/{vi,ex,view} &>/dev/null && \
+	rm -f "${ROOT}@GENTOO_PORTAGE_EPREFIX@"/usr/share/man/man1/{vi,ex,view}.1{,.gz,.bz2,.lzma} &>/dev/null
 }
 
 # set a man page symlink
@@ -36,7 +36,7 @@
 	local target="${1}" link_name="${2}" x extension
 
 	for x in ".1" ".1.bz2" ".1.gz" ".1.lzma" ; do
-		if [[ -e /usr/share/man/man1/${target}${x} ]] ; then
+		if [[ -e "@GENTOO_PORTAGE_EPREFIX@"/usr/share/man/man1/${target}${x} ]] ; then
 			extension="${x}"
 			break
 		fi
@@ -48,7 +48,7 @@
 	fi
 
 	ln -s "${target}${extension}" \
-		"${ROOT}/usr/share/man/man1/${link_name}${extension}"
+		"${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/share/man/man1/${link_name}${extension}"
 }
 
 # set the vi, ex, view, and man vi symlinks
@@ -61,9 +61,9 @@
 
 	local dir
 	if [[ ${target} == "busybox" ]]; then
-		dir="${ROOT}/bin"
+		dir="${ROOT}@GENTOO_PORTAGE_EPREFIX@/bin"
 	else
-		dir="${ROOT}/usr/bin"
+		dir="${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin"
 	fi
 
 	if [[ -f "${dir}/${target}" ]] ; then
@@ -75,11 +75,11 @@
 		set_man_symlink "${target}" "view"
 
 		# it's not okay if these fail
-		ln -s "${dir}/${target}" "${ROOT}/usr/bin/vi" || \
+		ln -s "${dir}/${target}" "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" || \
 			die "Couldn't set ${target} /usr/bin/vi symlink"
-		ln -s "${dir}/${target}" "${ROOT}/usr/bin/ex" || \
+		ln -s "${dir}/${target}" "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/ex" || \
 			die "Couldn't set ${target} /usr/bin/ex symlink"
-		ln -s "${dir}/${target}" "${ROOT}/usr/bin/view" || \
+		ln -s "${dir}/${target}" "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/view" || \
 			die "Couldn't set ${target} /usr/bin/view symlink"
 	else
 		die -q  "Target \"${1}\" doesn't appear to be valid!"
@@ -96,9 +96,9 @@
 	[[ -z "${@}" ]] || die -q "Too many parameters"
 
 	write_list_start "Current vi implementation:"
-	if [[ -L "${ROOT}/usr/bin/vi" ]] ; then
-		write_kv_list_entry "$(basename $(canonicalise ${ROOT}/usr/bin/vi ) )" ""
-	elif [[ -e "${ROOT}/usr/bin/vi" ]] ; then
+	if [[ -L "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
+		write_kv_list_entry "$(basename $(canonicalise ${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi ) )" ""
+	elif [[ -e "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		write_kv_list_entry "(not a symlink)" ""
 	else
 		write_kv_list_entry "(unset)" ""
@@ -118,7 +118,7 @@
 	targets=( $(find_targets ) )
 	if [[ -n ${targets[@]} ]] ; then
 		for (( i = 0 ; i < ${#targets[@]} ; i = i + 1 )) ; do
-			[[ ${targets[${i}]} == $(basename $(canonicalise ${ROOT}/usr/bin/vi ) ) ]] && \
+			[[ ${targets[${i}]} == $(basename $(canonicalise ${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi ) ) ]] && \
 				targets[${i}]="${targets[${i}]} $(highlight '*' )"
 		done
 		write_list_start "Available vi implementations:"
@@ -149,15 +149,15 @@
 	elif [[ -n "${2}" ]] ; then
 		die -q "Too many parameters"
 
-	elif [[ -L "${ROOT}/usr/bin/vi" ]] ; then
+	elif [[ -L "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		if ! remove_symlinks ; then
 			die -q "Can't remove existing provider"
 		elif ! set_symlinks "${1}" ; then
 			die -q "Can't set new provider"
 		fi
 
-	elif [[ -e "${ROOT}/usr/bin/vi" ]] ; then
-		die -q "Sorry, ${ROOT}/usr/bin/vi confuses me"
+	elif [[ -e "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
+		die -q "Sorry, ${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi confuses me"
 
 	else
 		set_symlinks "${1}" || die -q "Can't set a new provider"
@@ -178,11 +178,11 @@
 	[[ -z "${1}" ]] || ( [[ -z "${2}" ]] && [[ "${1}" == "--if-unset" ]] ) || \
 		die -q "Usage error"
 
-	if [[ -L "${ROOT}/usr/bin/vi" ]] ; then
+	if [[ -L "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		[[ ${1} == "--if-unset" ]] && return
 		remove_symlinks || die -q "Can't remove existing link"
 	fi
-	if [[ -e "${ROOT}/usr/bin/vi" ]] ; then
+	if [[ -e "${ROOT}@GENTOO_PORTAGE_EPREFIX@/usr/bin/vi" ]] ; then
 		die -q "Can't set a new provider"
 	elif ! [[ -z $(find_targets ) ]] ; then
 		set_symlinks 1 || die -q "Can't set a new provider"
