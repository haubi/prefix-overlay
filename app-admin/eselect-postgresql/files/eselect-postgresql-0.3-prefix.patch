--- postgresql.eselect.orig	2008-07-23 12:52:36.773195000 -0500
+++ postgresql.eselect	2008-07-23 12:55:15.738208000 -0500
@@ -18,7 +18,7 @@
 
 	do_list() {
 		write_list_start "Available postgresql installations"
-		for s in /etc/eselect/postgresql/slots/* ; do
+		for s in "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/slots/* ; do
 			[[ -d "$s" ]] || continue;
 			local slot=$(basename $s)
 			local postgres_ebuilds=""
@@ -26,10 +26,10 @@
 				source "$src"
 			done
 			local kw="${slot}"
-			if [[ "$(canonicalise /etc/eselect/postgresql/active)" = "$(canonicalise ${s})" ]] ; then
+			if [[ "$(canonicalise "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active)" = "$(canonicalise ${s})" ]] ; then
 				kw="$kw <-*"
 			fi
-			if [[ "$(canonicalise /etc/eselect/postgresql/service)" = "$(canonicalise ${s})" ]] ; then
+			if [[ "$(canonicalise "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service)" = "$(canonicalise ${s})" ]] ; then
 				kw="$kw <-S"
 			fi
 			write_kv_list_entry "${kw}" "${postgres_ebuilds//postgresql-/}"
@@ -44,8 +44,8 @@
 		echo "Show currently selected PostgreSQL installation"
 	}
 	do_show() {
-		if [[ -r "/etc/eselect/postgresql/active" ]] ; then
-			local bn=$(basename $(canonicalise /etc/eselect/postgresql/active))
+		if [[ -r ""@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active" ]] ; then
+			local bn=$(basename $(canonicalise "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active))
 			local slot=${bn}
 			echo "${slot}"
 		else
@@ -73,8 +73,8 @@
 		echo "Show currently selected postgresql server"
 	}
 	do_show-service() {
-		if [[ -r "/etc/eselect/postgresql/service" ]] ; then
-			local bn=$(basename $(canonicalise /etc/eselect/postgresql/service))
+		if [[ -r ""@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service" ]] ; then
+			local bn=$(basename $(canonicalise "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service))
 			local slot=${bn}
 			echo "${slot}"
 		else
@@ -91,9 +91,9 @@
 	}
 
 	do_set() {
-		local alibdir='/usr/lib/'
+		local alibdir='"@GENTOO_PORTAGE_EPREFIX@"/usr/lib/'
 		[[ ${#@} -ne 1 ]] && die -q "Only one parameter is expected"
-		local slotdir="/etc/eselect/postgresql/slots/${1}"
+		local slotdir=""@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/slots/${1}"
 		[[ -d "${slotdir}" ]] || die -q "No such version installed"
 		do_reset
 		unset postgres_symlinks
@@ -122,9 +122,9 @@
 				[[ -L "$d" ]] || die -q "$d exists and is not a symbolic link"
 			fi
 		done
-		mkdir -p /etc/eselect/postgresql &>/dev/null || die "Failed to create /etc/eselect/postgresql"
-		exec 9>/etc/eselect/postgresql/active.links || die "Failed to store list of links"
-		ln -sf slots/${1} /etc/eselect/postgresql/active
+		mkdir -p "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql &>/dev/null || die "Failed to create "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql"
+		exec 9>"@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active.links || die "Failed to store list of links"
+		ln -sf slots/${1} "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active
 		for (( i=0;i<slinks;i++ )); do
 			local s=${postgres_symlinks[i]};
 			(( i++ ));
@@ -144,18 +144,18 @@
 	}
 
 	do_set-service() {
-		local alibdir='/usr/lib/'
+		local alibdir='"@GENTOO_PORTAGE_EPREFIX@"/usr/lib/'
 		[[ ${#@} -ne 1 ]] && die -q "Only one parameter is expected"
-		local slotdir="/etc/eselect/postgresql/slots/${1}"
+		local slotdir=""@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/slots/${1}"
 		[[ -d "${slotdir}" ]] || die -q "No such version installed"
 		do_reset-service
 		unset postgres_service
 		local p_service="$(for s in ${slotdir}/* ; do source $s ; done ; echo $postgres_service)"
-		[[ -x "/etc/init.d/${p_service}" ]] || die -1 "Selected installation doesn't provide PostgreSQL service"
-		mkdir -p /etc/eselect/postgresql &>/dev/null || die "Failed to create /etc/eselect/postgresql"
-		rm -f /etc/eselect/postgresql/service
-		ln -sf slots/${1} /etc/eselect/postgresql/service
-		touch /etc/conf.d/${p_service}
+		[[ -x ""@GENTOO_PORTAGE_EPREFIX@"/etc/init.d/${p_service}" ]] || die -1 "Selected installation doesn't provide PostgreSQL service"
+		mkdir -p "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql &>/dev/null || die "Failed to create "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql"
+		rm -f "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service
+		ln -sf slots/${1} "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service
+		touch "@GENTOO_PORTAGE_EPREFIX@"/etc/conf.d/${p_service}
 	}
 ## }}}
 
@@ -181,10 +181,10 @@
 	}
 
 	do_reset() {
-		local alibdir='/usr/lib/'
-		if [[ -d "$(canonicalise /etc/eselect/postgresql/active)" ]] ; then
-			if [[ -r /etc/eselect/postgresql/active.links ]] ; then
-				exec 9</etc/eselect/postgresql/active.links || die "Failed to access the list of links"
+		local alibdir='"@GENTOO_PORTAGE_EPREFIX@"/usr/lib/'
+		if [[ -d "$(canonicalise "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active)" ]] ; then
+			if [[ -r "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active.links ]] ; then
+				exec 9<"@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active.links || die "Failed to access the list of links"
 				while IFS='' read -u 9 slink ; do
 					if [[ -e "$slink" ]] ; then
 						if [[ -L "$slink" ]] ; then
@@ -194,9 +194,9 @@
 						fi
 					fi
 				done
-				rm -f /etc/eselect/postgresql/active.links
+				rm -f "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active.links
 			fi
-			rm -f /etc/eselect/postgresql/active
+			rm -f "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active
 		fi
 	}
 ## }}}
@@ -209,10 +209,10 @@
 	}
 
 	do_reset-service() {
-		if [[ -L /etc/eselect/postgresql/service ]] ; then
-			local p_service="$(for s in /etc/eselect/postgresql/service/* ; do source $s ; done ; echo "$postgres_service")"
-			[[ -e "/etc/conf.d/${p_service}" ]] && touch "/etc/conf.d/${p_service}"
-			rm -f /etc/eselect/postgresql/service
+		if [[ -L "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service ]] ; then
+			local p_service="$(for s in "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service/* ; do source $s ; done ; echo "$postgres_service")"
+			[[ -e ""@GENTOO_PORTAGE_EPREFIX@"/etc/conf.d/${p_service}" ]] && touch ""@GENTOO_PORTAGE_EPREFIX@"/etc/conf.d/${p_service}"
+			rm -f "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service
 		fi
 	}
 ## }}}
@@ -238,7 +238,7 @@
 	do_update() {
 		# collect all binaries names
 		local binaries="$((
-			for s in /etc/eselect/postgresql/slots/* ; do
+			for s in "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/slots/* ; do
 				[[ -d "$s" ]] || continue;
 				local slot=$(basename $s)
 				for src in ${s}/* ; do
@@ -247,26 +247,26 @@
 				ls -1 ${postgres_bindir}/
 			done
 		) | sort | uniq)"
-		local links="$(find /usr/bin/* -type d -prune -o -lname /usr/lib/eselect-postgresql/binwrapper -print)"
+		local links="$(find "@GENTOO_PORTAGE_EPREFIX@"/usr/bin/* -type d -prune -o -lname "@GENTOO_PORTAGE_EPREFIX@"/usr/lib/eselect-postgresql/binwrapper -print)"
 		local i
 		for i in ${binaries} ; do
-			local lip="/usr/bin/${i}"
+			local lip=""@GENTOO_PORTAGE_EPREFIX@"/usr/bin/${i}"
 			links="$(echo "${links}"|grep -v "^${lip}\$")"
 			[[ -L "${lip}" ]] && continue
 			[[ -e "${lip}" ]] && die "${lip} exists and is not a symbolic link"
 			echo "Creating ${lip} symlink..."
-			ln -s /usr/lib/eselect-postgresql/binwrapper "${lip}"
+			ln -s "@GENTOO_PORTAGE_EPREFIX@"/usr/lib/eselect-postgresql/binwrapper "${lip}"
 		done
 		# cleanup leftovers
 		for i in ${links} ; do
 			echo "Removing ${i} symlink.."
 			rm "${i}"
 		done
-		if test -L /etc/eselect/postgresql/active -a ! -d /etc/eselect/postgresql/active ; then
+		if test -L "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active -a ! -d "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/active ; then
 			echo "Resetting uninstalled selection"
 			do_reset
 		fi
-		if test -L /etc/eselect/postgresql/service -a ! -d /etc/eselect/postgresql/service ; then
+		if test -L "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service -a ! -d "@GENTOO_PORTAGE_EPREFIX@"/etc/eselect/postgresql/service ; then
 			echo "Resetting uninstalled selection"
 			do_reset-service
 		fi
