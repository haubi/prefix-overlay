--- epm
+++ epm
@@ -1,4 +1,4 @@
-#!/usr/bin/perl -wI.
+#!@GENTOO_PORTAGE_EPREFIX@/usr/bin/perl -wI.
 # $Id: epm,v 1.33 2006/09/13 15:09:19 agriffis Exp $
 
 use Getopt::Long;
@@ -7,7 +7,7 @@
 # Global vars
 (my $version = '$Revision: 1.33 $') =~ s/.*?(\d.*\d).*/EPM version $1/;
 my $verbose = 0;
-my $dbpath = '/var/db/pkg';
+my $dbpath = '@GENTOO_PORTAGE_EPREFIX@/var/db/pkg';
 my $pkgregex =
     '^.+?\/'.					# group (ignored)
     '(.+?)'.					# name
@@ -266,11 +266,11 @@
     if ($opt{'c'}) {
 	# Read in CONFIG_PROTECT from /etc/make.{global,conf}
 	my (@CONFIG_PROTECT) = split ' ',
-	    `. /etc/make.globals; . /etc/make.conf; echo \$CONFIG_PROTECT`;
+	    `. @GENTOO_PORTAGE_EPREFIX@/etc/make.globals; .  @GENTOO_PORTAGE_EPREFIX@/etc/make.conf; echo \$CONFIG_PROTECT`;
 	die "CONFIG_PROTECT is empty" unless @CONFIG_PROTECT;
 	my ($confprotre) = join '|', @CONFIG_PROTECT;
 	@files = grep {
-	    (split ' ', $_, 2)[1] =~ /^($confprotre)/o } @files;
+	    (split ' ', $_, 2)[1] =~ /^@GENTOO_PORTAGE_EPREFIX@($confprotre)/o } @files;
     }
 
     # Trim @files if doc files requested
