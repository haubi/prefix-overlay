http://bugs.gentoo.org/show_bug.cgi?id=275304

--- poll/unix/poll.c
+++ poll/unix/poll.c
@@ -73,7 +73,7 @@ APR_DECLARE(apr_status_t) apr_poll(apr_p
                                    apr_int32_t *nsds, 
                                    apr_interval_time_t timeout)
 {
-    int i, num_to_poll;
+    int i, num_to_poll, breakloop;
 #ifdef HAVE_VLA
     /* XXX: I trust that this is a segv when insufficient stack exists? */
     struct pollfd pollset[num];
@@ -100,19 +100,23 @@ APR_DECLARE(apr_status_t) apr_poll(apr_p
             return APR_ENOMEM;
     }
 #endif
+    breakloop = 0;
     for (i = 0; i < num; i++) {
-        if (aprset[i].desc_type == APR_POLL_SOCKET) {
-            pollset[i].fd = aprset[i].desc.s->socketdes;
-        }
-        else if (aprset[i].desc_type == APR_POLL_FILE) {
-            pollset[i].fd = aprset[i].desc.f->filedes;
-        }
-        else {
-            break;
+        if (0 == breakloop) {
+            if (aprset[i].desc_type == APR_POLL_SOCKET) {
+                pollset[i].fd = aprset[i].desc.s->socketdes;
+            }
+            else if (aprset[i].desc_type == APR_POLL_FILE) {
+                pollset[i].fd = aprset[i].desc.f->filedes;
+            }
+            else {
+                num_to_poll = i;
+                breakloop = 1;
+            }
+            if (0 == breakloop)
+                pollset[i].events = get_event(aprset[i].reqevents);
         }
-        pollset[i].events = get_event(aprset[i].reqevents);
     }
-    num_to_poll = i;
 
     if (timeout > 0) {
         timeout /= 1000; /* convert microseconds to milliseconds */
