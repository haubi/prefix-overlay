reported upstream to rt@openssl.org on 24 Apr 2009:
http://rt.openssl.org/Ticket/Display.html?id=1908

--- openssl-0.9.8f/crypto/bio/bss_dgram.c.orig	Fri Oct 19 16:18:40 2007
+++ openssl-0.9.8f/crypto/bio/bss_dgram.c	Fri Oct 19 16:19:55 2007
@@ -341,6 +341,7 @@
 
         memcpy(&(data->peer), to, sizeof(struct sockaddr));
         break;
+#if defined(SO_RCVTIMEO)
 	case BIO_CTRL_DGRAM_SET_RECV_TIMEOUT:
 		if ( setsockopt(b->num, SOL_SOCKET, SO_RCVTIMEO, ptr,
 			sizeof(struct timeval)) < 0)
@@ -351,6 +352,8 @@
 			ptr, (void *)&ret) < 0)
 			{ perror("getsockopt"); ret = -1; }
 		break;
+#endif
+#if defined(SO_SNDTIMEO)
 	case BIO_CTRL_DGRAM_SET_SEND_TIMEOUT:
 		if ( setsockopt(b->num, SOL_SOCKET, SO_SNDTIMEO, ptr,
 			sizeof(struct timeval)) < 0)
@@ -361,6 +364,7 @@
 			ptr, (void *)&ret) < 0)
 			{ perror("getsockopt"); ret = -1; }
 		break;
+#endif
 	case BIO_CTRL_DGRAM_GET_SEND_TIMER_EXP:
 		/* fall-through */
 	case BIO_CTRL_DGRAM_GET_RECV_TIMER_EXP:

